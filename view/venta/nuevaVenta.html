<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Document</title>
    
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
</head>

<body>

    <div class="container">

        <h2>Crear venta</h2>
        <form class="row g-3 needs-validation" novalidate>
            <div class="col-md-6">
                <label for="validationCustom01" for="cliente_id" class="form-label">Nombre del cliente:</label>
                <input type="hidden" id="selected_cliente_id" name="selected_cliente_id"value="">
                <input type="text" list="cliente_id" class="form-control" name="cliente_id" id="cliente_id">
                <div class="invalid-feedback">
                    Por favor, ingresa un nombre del producto.
                </div>
                <div class="valid-feedback">
                    ¡Se ve bien!
                </div>
            </div>

            <div class="col-md-6">
                <label for="validationCustom01" class="form-label">Total</label>
                <input type="text" class="form-control" id="total" value="" required>
                <div class="invalid-feedback">
                    Por favor, ingresa un nombre del producto.
                </div>
                <div class="valid-feedback">
                    ¡Se ve bien!
                </div>
            </div>

            <div class="col-md-5">
                <label for="validationCustom02" class="form-label">Fecha de venta:</label>
                <input type="date" class="form-control" id="fechaDeVenta" value="" required>
                <div class="invalid-feedback">
                    Por favor, ingresa su descripcion
                </div>
                <div class="valid-feedback">
                    ¡Se ve bien!
                </div>
            </div>






            <div class="col-md-3">
                <label for="validationCustom03" class="form-label">Estado:</label>
                <select class="form-select" id="estado">
                    <option selected>--select--</option>
                    <option value="PENDIENTE DE PAGO">PENDIENTE DE PAGO</option>
                    <option value="PAGADA">PAGADA</option>
                    <option value="CANCELADA">CANCELADA</option>

                   
                </select>

                <div class="invalid-feedback">
                    Por favor, ingresa el estado del cliente.
                </div>
                <div class="valid-feedback">
                    ¡Se ve bien!
                </div>
            </div>
                <hr>
                <legend>Detalles</legend>
                <div class="col-md-6">
                    <label for="validationCustom01" for="producto_id" class="form-label">Nombre del Producto:</label>
                    <input type="hidden" id="selected_producto_id" name="selected_producto_id"value="">
                    <input type="text" list="producto_id" class="form-control" name="producto_id" id="producto_id">
                    <div class="invalid-feedback">
                        Por favor, ingresa un nombre del producto.
                    </div>
                    <div class="valid-feedback">
                        ¡Se ve bien!
                    </div>
                </div>
    
              
    
    
              
                <div class="col-md-2">
                    <label for="validationCustomUsername" class="form-label">Cantidad:</label>
                    <div class="input-group has-validation">
                        <input type="number" class="form-control" id="cantidad" aria-describedby="inputGroupPrepend"
                            required placeholder="0">
                        <div class="invalid-feedback">
                            Por favor, ingresa su cantidas.
                        </div>
                        <div class="valid-feedback">
                            ¡Se ve bien!
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <label for="validationCustom01" class="form-label">Precio:</label>
                    <input type="number" class="form-control" id="precio" value="" required placeholder="0">
                    <div class="invalid-feedback">
                        Por favor, ingresa su precio.
                    </div>
                    <div class="valid-feedback">
                        ¡Se ve bien!
                    </div>
                </div>
    
             
                <div class="col-md-2">
                    <label for="validationCustomUsername" class="form-label">% Descuento:</label>
                    <div class="input-group has-validation">
                        <input type="number" class="form-control" id="procentajeDescuento"
                            aria-describedby="inputGroupPrepend" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa un dirección.
                        </div>
                        <div class="valid-feedback">
                            ¡Se ve bien!
                        </div>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <label for="validationCustomUsername" class="form-label">SubTotal:</label>
                    <div class="input-group has-validation">
                        <input type="number" class="form-control" id="subtotal"
                            aria-describedby="inputGroupPrepend" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa un dirección.
                        </div>
                        <div class="valid-feedback">
                            ¡Se ve bien!
                        </div>
                    </div>
                </div>
    
                <div class="col-md-3">
                   
    
                    <div class="invalid-feedback">
                        Por favor, ingresa el estado del cliente.
                    </div>
                    <div class="valid-feedback">
                        ¡Se ve bien!
                    </div>
                </div>
                <div class="col-12">
                    <button id="submitBtn" class="btn btn-primary" type="button">Crear Venta</button>
                </div>

           
        </form>
    

       

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/venta/nuevaVenta.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
        
        loadCliente();
        
        loadCProducto();
    </script>

    <script>
        document.getElementById('submitBtn').addEventListener('click', function (event) {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function (form) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                    form.classList.add('was-validated');
                } else {

                    save();
                }
            });
        });

        
function calcularSubtotal() {
    var cantidad = parseFloat(document.getElementById('cantidad').value);
    var precio = parseFloat(document.getElementById('precio').value);
    var subtotal = cantidad * precio;
    document.getElementById('subtotal').value = subtotal.toFixed(2);
    
    calcularTotal(); 
}

// Función para calcular el total y actualizar el input correspondiente
function calcularTotal() {
    var subtotal = parseFloat(document.getElementById('subtotal').value);
    var descuento = parseFloat(document.getElementById('procentajeDescuento').value);
 
    var total = subtotal - descuento ;
    console.log(total);
    document.getElementById('total').value = total.toFixed(2); // Redondeamos a 2 decimales
}

// Asociar la función de cálculo al evento 'input' en los campos de cantidad, precio, descuento e IVA
document.getElementById('cantidad').addEventListener('input', calcularSubtotal);
document.getElementById('precio').addEventListener('input', calcularSubtotal);
document.getElementById('procentajeDescuento').addEventListener('input', calcularTotal);
document.getElementById('iva').addEventListener('input', calcularTotal);


calcularSubtotal();



    </script>
</body>

</html>